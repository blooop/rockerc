#!/bin/bash
# SessionStart hook for Claude Code online environment
# This script sets up the Python development environment using pixi

set -e

echo "ğŸš€ Setting up Python Template environment..."

# Check if pixi is installed
if ! command -v pixi &> /dev/null; then
    echo "ğŸ“¦ Installing pixi..."
    curl -fsSL https://pixi.sh/install.sh | bash

    # Add pixi to PATH for current session
    export PATH="$HOME/.pixi/bin:$PATH"

    # Source bashrc to get pixi in PATH (if bashrc was updated)
    [ -f "$HOME/.bashrc" ] && source "$HOME/.bashrc"

    echo "âœ… Pixi installed successfully"
else
    echo "âœ… Pixi already installed"
fi

# Ensure pixi is in PATH for this session
export PATH="$HOME/.pixi/bin:$PATH"

# Install project dependencies
echo "ğŸ“¦ Installing project dependencies..."
pixi install

# Run pre-commit installation
echo "ğŸ”§ Setting up pre-commit hooks..."
pixi run pre-commit install || echo "âš ï¸  Pre-commit installation skipped (optional)"

# Set up git merge driver for lockfiles
echo "ğŸ”§ Configuring git merge driver..."
pixi run setup-git-merge-driver || true

echo "âœ… Environment setup complete!"
echo ""
echo "Available pixi tasks:"
pixi task list
echo ""
echo "ğŸ’¡ Common commands:"
echo "  pixi run test        - Run tests"
echo "  pixi run lint        - Run linters"
echo "  pixi run format      - Format code"
echo "  pixi run ci          - Run full CI pipeline"
echo ""
